# Architecture

## Модульная структура

Проект построен на принципах модульности - каждый модуль независим и может быть изменен без влияния на другие части системы.

### Модули

```
capacity_manager/
├── models/           # Модели данных (DTOs, dataclasses)
├── config/           # Управление конфигурацией
├── grafana_api/      # Клиент Grafana API
├── metrics_collector/# Сбор метрик из Grafana
├── analyzer/         # Анализ загрузки каналов
├── reporters/        # Генерация отчетов
├── cli/              # CLI интерфейс
└── utils/            # Вспомогательные утилиты
```

### 1. models/
**Ответственность**: Определение структур данных
- Интерфейсы/каналы
- Метрики
- Результаты анализа
- Отчеты

**Зависимости**: Нет

### 2. config/
**Ответственность**: Управление конфигурацией
- Чтение YAML конфигов
- Валидация параметров
- Настройки по умолчанию

**Зависимости**: models

### 3. grafana_api/
**Ответственность**: Взаимодействие с Grafana API
- HTTP клиент
- Аутентификация
- Выполнение запросов

**Зависимости**: models, config

### 4. metrics_collector/
**Ответственность**: Сбор метрик
- Получение данных через grafana_api
- Агрегация метрик
- Кэширование

**Зависимости**: models, grafana_api

### 5. analyzer/
**Ответственность**: Анализ данных
- Расчет утилизации
- Определение порогов (warning/critical)
- Выявление трендов
- Прогнозирование

**Зависимости**: models

### 6. reporters/
**Ответственность**: Генерация отчетов
- Консольный вывод (Rich tables)
- HTML отчеты
- CSV/Excel экспорт

**Зависимости**: models

### 7. cli/
**Ответственность**: Командный интерфейс
- Парсинг аргументов
- Оркестрация модулей
- Обработка ошибок

**Зависимости**: Все модули

### 8. utils/
**Ответственность**: Вспомогательные функции
- Логирование
- Форматирование
- Хелперы

**Зависимости**: Нет

## Принципы

1. **Независимость модулей**: Каждый модуль может быть заменен без изменения других
2. **Единая ответственность**: Один модуль - одна задача
3. **Инверсия зависимостей**: Модули зависят от абстракций, а не от конкретных реализаций
4. **Открыт для расширения**: Легко добавить новые типы отчетов, источники данных и т.д.
