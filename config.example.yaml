# Example configuration file for Capacity Manager
# Copy to config.yaml and adjust for your environment

grafana:
  url: "https://grafana.example.com"
  # Token can be set directly or via environment variable
  # Use $ENV_VAR_NAME to read from environment
  token: "$GRAFANA_TOKEN"  # or paste token directly
  verify_ssl: true
  timeout: 30
  # Optional: specify datasource UID (uses first available if not set)
  datasource_uid: null

thresholds:
  warning_percent: 70.0
  critical_percent: 85.0

report:
  output_dir: "./reports"
  include_graphs: true
  top_channels_limit: 20

metrics:
  # Default time range for analysis (in hours)
  default_hours: 24

  # Metric names from your Prometheus/monitoring system
  traffic_in_metric: "ifInOctets"
  traffic_out_metric: "ifOutOctets"
  errors_in_metric: "ifInErrors"
  errors_out_metric: "ifOutErrors"

  # Sampling interval
  sample_interval_minutes: 5

# Channel definitions
channels:
  # External channels (интернет-каналы, пиринги)
  - name: "Internet-Provider1"
    type: "external"
    capacity_mbps: 10000
    description: "Primary Internet uplink"
    site_a: "MSK-DC1"
    device_a: "CORE-RTR-01"
    interface_pattern: "GigabitEthernet0/0/1"
    tags: ["internet", "primary", "critical"]
    # Pricing configuration
    pricing:
      model: "per_mbps"  # flat_rate, per_mbps, tiered, usage_based
      currency: "USD"
      cost_per_mbps_month: 50  # $50 per Mbps per month
      setup_fee: 5000  # One-time setup fee
      upgrade_fee_percent: 10  # 10% fee on upgrade cost
      support_cost_month: 1000  # Monthly support
      sla_cost_month: 500  # Premium SLA
      contract_term_months: 12
      notes: "Standard enterprise contract"

  - name: "IX-Moscow"
    type: "external"
    capacity_mbps: 40000
    description: "Moscow Internet Exchange"
    site_a: "MSK-DC1"
    device_a: "CORE-RTR-02"
    interface_pattern: "TenGigE0/1/0"
    tags: ["peering", "ix"]
    # Tiered pricing example
    pricing:
      model: "tiered"
      currency: "USD"
      tiers:
        - up_to_mbps: 10000
          cost_per_mbps: 30
        - up_to_mbps: 40000
          cost_per_mbps: 25
        - up_to_mbps: 100000
          cost_per_mbps: 20
      setup_fee: 10000
      support_cost_month: 2000
      contract_term_months: 24
      notes: "IX Moscow peering - volume discounts apply"

  # Burstable billing example (95th percentile)
  - name: "Peering-Provider-X"
    type: "external"
    capacity_mbps: 10000  # Port capacity
    description: "Burstable peering with 95th percentile billing"
    site_a: "MSK-DC1"
    device_a: "CORE-RTR-03"
    interface_pattern: "TenGigE0/1/1"
    tags: ["peering", "burstable"]
    pricing:
      model: "burstable_95"
      currency: "USD"
      committed_rate_mbps: 1000  # Minimum commit (always billed)
      burstable_rate_mbps: 10000  # Maximum burst (port capacity)
      cost_per_mbps_month: 40  # Cost per Mbps at 95th percentile
      setup_fee: 3000
      support_cost_month: 500
      contract_term_months: 12
      notes: "Burstable 10G port with 1G commit. Billing based on 95th percentile of traffic, min 1G. Allows bursts up to 10G without penalty."

  # Inter-site channels (каналы между площадками)
  - name: "MSK-DC1-to-SPB-DC1"
    type: "inter_site"
    capacity_mbps: 100000
    description: "Moscow to St.Petersburg backbone"
    site_a: "MSK-DC1"
    site_b: "SPB-DC1"
    device_a: "CORE-RTR-01"
    device_b: "CORE-RTR-05"
    interface_pattern: "HundredGigE0/2/0"
    tags: ["backbone", "critical"]
    # Flat rate pricing example
    pricing:
      model: "flat_rate"
      currency: "USD"
      monthly_cost: 80000  # Fixed monthly cost
      setup_fee: 50000
      upgrade_fee_percent: 15
      support_cost_month: 5000
      sla_cost_month: 2000
      contract_term_months: 36
      notes: "100G dark fiber lease"

  - name: "MSK-DC1-to-EKB-DC1"
    type: "inter_site"
    capacity_mbps: 40000
    description: "Moscow to Ekaterinburg link"
    site_a: "MSK-DC1"
    site_b: "EKB-DC1"
    device_a: "CORE-RTR-03"
    device_b: "CORE-RTR-10"
    tags: ["regional"]
    # Usage-based pricing example
    pricing:
      model: "usage_based"
      currency: "USD"
      monthly_cost: 15000  # Base cost
      cost_per_gb: 0.05  # $0.05 per GB over included
      included_gb_month: 100000  # 100TB included
      support_cost_month: 1500
      contract_term_months: 12
      notes: "Pay-per-use with 100TB included"

  # Transport channels (внутриплощадочные каналы между оборудованием)
  - name: "CORE-01-to-AGG-01"
    type: "transport"
    capacity_mbps: 20000
    description: "Core to Aggregation link"
    site_a: "MSK-DC1"
    device_a: "CORE-RTR-01"
    device_b: "AGG-SW-01"
    interface_pattern: "TenGigE0/3/0"
    tags: ["core", "aggregation"]
    # Internal transport - часто без прямой стоимости или учёт amortization
    pricing:
      model: "flat_rate"
      currency: "USD"
      monthly_cost: 2000  # Equipment amortization
      notes: "Internal infrastructure amortization"

  - name: "CORE-02-to-AGG-02"
    type: "transport"
    capacity_mbps: 20000
    description: "Core to Aggregation link (redundant)"
    site_a: "MSK-DC1"
    device_a: "CORE-RTR-02"
    device_b: "AGG-SW-02"
    interface_pattern: "TenGigE0/3/1"
    tags: ["core", "aggregation", "redundant"]
    pricing:
      model: "flat_rate"
      currency: "USD"
      monthly_cost: 2000
      notes: "Internal infrastructure amortization"
